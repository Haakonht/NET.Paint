<UserControl x:Class="NET.Paint.View.Component.Overview.ProjectTree" 
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation" 
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml" 
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:icons="clr-namespace:Material.Icons.WPF;assembly=Material.Icons.WPF" 
             xmlns:service="clr-namespace:NET.Paint.Drawing.Service;assembly=NET.Paint.Drawing" 
             xmlns:controls="clr-namespace:NET.Paint.View.Component.Overview.Controls" 
             xmlns:selectors="clr-namespace:NET.Paint.Selector" 
             xmlns:structure="clr-namespace:NET.Paint.Drawing.Model.Structure;assembly=NET.Paint.Drawing" 
             xmlns:converters="clr-namespace:NET.Paint.Converter" 
             mc:Ignorable="d" d:DesignHeight="450" d:DesignWidth="250" d:Background="White" 
             d:DataContext="{d:DesignInstance Type=service:DesktopViewModel, IsDesignTimeCreatable=True}">
    <UserControl.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="../../../Resources/ShapeIcons.xaml"/>
                <ResourceDictionary Source="../../../Resources/ToolIcons.xaml"/>
                <ResourceDictionary Source="Resources/StretchingTreeView.xaml"/>
            </ResourceDictionary.MergedDictionaries>

            <ContextMenu x:Key="ImageContextMenu" DataContext="{Binding RelativeSource={RelativeSource AncestorType=UserControl}, Path=DataContext}">
                <MenuItem Header="Add" Click="AddImage" Icon="{icons:MaterialIconExt Kind=FileImageAddOutline}"/>
                <MenuItem Header="Remove" Command="{Binding Command.RemoveItem}" CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType=ContextMenu}}" Icon="{icons:MaterialIconExt Kind=FileImageRemoveOutline}"/>
            </ContextMenu>

            <ContextMenu x:Key="LayerContextMenu" DataContext="{Binding RelativeSource={RelativeSource AncestorType=UserControl}, Path=DataContext}">
                <MenuItem Header="Add" Icon="{icons:MaterialIconExt Kind=LayersPlus}">
                    <MenuItem Header="Vector" Click="AddVectorLayer">
                        <MenuItem.Icon>
                            <icons:MaterialIcon Kind="LayersOutline" Foreground="Green"/>
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem Header="Hybrid" Click="AddHybridLayer">
                        <MenuItem.Icon>
                            <icons:MaterialIcon Kind="LayersOutline" Foreground="Black"/>
                        </MenuItem.Icon>
                    </MenuItem>
                    <MenuItem Header="Raster" Click="AddRasterLayer">
                        <MenuItem.Icon>
                            <icons:MaterialIcon Kind="LayersOutline" Foreground="Red"/>
                        </MenuItem.Icon>
                    </MenuItem>
                </MenuItem>
                <MenuItem Header="Edit" Icon="{icons:MaterialIconExt Kind=LayersEdit}">
                    <MenuItem Header="Cut" Command="{Binding Command.Cut}" CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType=ContextMenu}}" Icon="{icons:MaterialIconExt Kind=ContentCut}"/>
                    <MenuItem Header="Copy" Command="{Binding Command.Copy}" CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType=ContextMenu}}" Icon="{icons:MaterialIconExt Kind=ContentCopy}"/>
                    <MenuItem Header="Paste" Command="{Binding Command.Paste}" CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType=ContextMenu}}" Icon="{icons:MaterialIconExt Kind=ContentPaste}"/>
                    <Separator/>
                    <MenuItem Header="Flatten" Command="{Binding Command.FlattenLayer}" CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType=ContextMenu}}" Icon="{icons:MaterialIconExt Kind=ImageFilterNone}"/>
                </MenuItem>
                <MenuItem Header="Remove" Command="{Binding DataContext.Command.RemoveItem, RelativeSource={RelativeSource AncestorType=UserControl}}" CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType=ContextMenu}}" Icon="{icons:MaterialIconExt Kind=LayersRemove}"/>
            </ContextMenu>

            <ContextMenu x:Key="RenderableContextMenu" DataContext="{Binding RelativeSource={RelativeSource AncestorType=UserControl}, Path=DataContext}">
                <MenuItem Header="Edit" Icon="{icons:MaterialIconExt Kind=SquareEditOutline}">
                    <MenuItem Header="Cut" Command="{Binding Command.Cut}" CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType=ContextMenu}}" Icon="{icons:MaterialIconExt Kind=ContentCut}"/>
                    <MenuItem Header="Copy" Command="{Binding Command.Copy}" CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType=ContextMenu}}" Icon="{icons:MaterialIconExt Kind=ContentCopy}"/>
                    <MenuItem Header="Paste" Command="{Binding Command.Paste}" CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType=ContextMenu}}" Icon="{icons:MaterialIconExt Kind=ContentPaste}"/>
                </MenuItem>
                <MenuItem Header="Remove" Command="{Binding Command.RemoveItem}" CommandParameter="{Binding PlacementTarget.DataContext, RelativeSource={RelativeSource AncestorType=ContextMenu}}" Icon="{icons:MaterialIconExt Kind=SquareOffOutline}"/>
            </ContextMenu>

            <DataTemplate x:Key="RasterLayerTemplate" DataType="{x:Type structure:XRasterLayer}">
                <controls:Layer DataContext="{Binding}" ContextMenu="{StaticResource LayerContextMenu}" MouseDown="SelectNode"/>
            </DataTemplate>
        </ResourceDictionary>
    </UserControl.Resources>
    
    <Border BorderBrush="LightGray">
        <StackPanel HorizontalAlignment="Stretch">
            <Grid Height="20" Margin="-2,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <StackPanel Orientation="Horizontal" Grid.Column="0">
                    <ToggleButton x:Name="FilterEnabled" Content="{icons:MaterialIconExt Kind=FilterOutline}" Width="20" Background="White" Checked="FilterEnabled_Checked" Unchecked="FilterEnabled_Checked"/>
                </StackPanel>
                <Grid Grid.Column="1">
                    <TextBox x:Name="FilterText" Text="" TextChanged="TextBox_TextChanged" LostFocus="FilterText_LostFocus" GotFocus="FilterText_GotFocus"/>
                    <TextBlock Text="Filter by title, type or id" Foreground="Gray" Margin="3,0,0,0" VerticalAlignment="Center" x:Name="FilterPlaceholder" IsHitTestVisible="False"/>
                </Grid>
                <StackPanel Orientation="Horizontal" Grid.Column="2">
                    <ToggleButton Content="{icons:MaterialIconExt Kind=ImageOffOutline}" Width="20" Background="White" />
                </StackPanel>
            </Grid>
            <ScrollViewer MouseDown="Unselect" HorizontalScrollBarVisibility="Disabled" VerticalScrollBarVisibility="Auto" DataContext="{Binding Project}" Margin="0,2,0,0">
                <TreeView x:Name="ImageTree" ItemsSource="{Binding Images}" BorderBrush="Transparent" Background="Transparent" Margin="0,-1,0,0" PreviewMouseLeftButtonDown="TreeView_PreviewMouseLeftButtonDown" MouseMove="TreeView_MouseMove" DragEnter="TreeView_DragOver" Drop="TreeView_Drop" AllowDrop="True" ItemContainerStyle="{StaticResource StretchingTreeView}">
                    <TreeView.ItemTemplate>
                        <HierarchicalDataTemplate ItemsSource="{Binding Layers}" DataType="{x:Type structure:XImage}">
                            <controls:Image DataContext="{Binding}" ContextMenu="{StaticResource ImageContextMenu}" MouseDown="SelectNode"/>
                            <HierarchicalDataTemplate.ItemTemplate>
                                <HierarchicalDataTemplate ItemsSource="{Binding Shapes}" DataType="{x:Type structure:XLayer}">
                                    <controls:Layer DataContext="{Binding}" ContextMenu="{StaticResource LayerContextMenu}" MouseDown="SelectNode"/>
                                    <HierarchicalDataTemplate.ItemTemplate>
                                        <DataTemplate DataType="{x:Type structure:XRenderable}">
                                            <controls:Renderable DataContext="{Binding}" ContextMenu="{StaticResource RenderableContextMenu}" MouseDown="SelectNode"/>
                                        </DataTemplate>
                                    </HierarchicalDataTemplate.ItemTemplate>
                                </HierarchicalDataTemplate>
                            </HierarchicalDataTemplate.ItemTemplate>
                        </HierarchicalDataTemplate>
                    </TreeView.ItemTemplate>
                    <TreeView.Resources>
                        <SolidColorBrush x:Key="{x:Static SystemColors.HighlightBrushKey}" Color="Transparent" />
                        <SolidColorBrush x:Key="{x:Static SystemColors.HighlightTextBrushKey}" Color="Black" />
                        <SolidColorBrush x:Key="{x:Static SystemColors.InactiveSelectionHighlightBrushKey}" Color="Transparent" />
                        <SolidColorBrush x:Key="{x:Static SystemColors.InactiveSelectionHighlightTextBrushKey}" Color="Black" />
                    </TreeView.Resources>
                </TreeView>
            </ScrollViewer>
        </StackPanel>
    </Border>
</UserControl>
